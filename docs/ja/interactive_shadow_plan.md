# 影インタラクティブアート システムプラン（日本語版）

## 1. コンセプト概要
プロジェクターとWebカメラを使用したインスタレーションで、複数の椅子に投影された「影の住人」が観客の行動に反応して席を移動したり表情を変えたりします。現実の観客が座る・近づく・ジェスチャーすることで、影が迷惑そうに席を空けたり、驚いて他の席へ移動したり、床に座り込んだりといった振る舞いを見せます。

## 2. ハードウェア構成
- **プロジェクター**: 1080p以上、台形補正やレンズシフト付き。スクリーンまたは白壁に投影し、椅子の配置と重ね合わせます。
- **Webカメラ**: 広角レンズで椅子全体を捉え、30fps以上の撮影が可能なもの。暗所性能向上のため補助照明も検討します。
- **計算機**: NVIDIA GPUを搭載したPC。カメラ映像の推論とリアルタイム描画を同時に処理します。
- **設置治具**: ArUcoやAprilTagなどのマーカー、椅子位置固定のための台座、床面のマーキングなど。

## 3. ソフトウェア構成
### 3.1 センサー処理
- OpenCVでカメラ映像を取得。
- MediaPipe Pose / OpenPoseで人体骨格点を推定し、座位判定・ジェスチャー抽出を行う。
- 椅子ごとの座標領域に対して観客の重心・腰の位置を比較し、占有状態を判定。

### 3.2 空間キャリブレーション
- カメラ座標と投影座標の対応を取るため、椅子座面の四隅座標を測定してホモグラフィ行列を算出。
- プロジェクションマッピング用テストパターンで歪みを調整し、UnityやTouchDesigner上で椅子配置を再現。

### 3.3 ロジック・状態管理
- 椅子ごとに `Empty` / `OccupiedByHuman` / `OccupiedByShadow` の状態を管理。
- 影キャラクターのステートマシン例:
  - `Idle`: 通常着席状態。
  - `Nervous`: 隣に観客が座ったら一席空ける。
  - `Surprised`: 同じ席に座られた際に驚いて別の席へ移動。
  - `Frustrated`: 空席が無くなった際に床に座り込む。
  - `Wander`: 様子を伺いながら周辺を移動。
- 観客の位置変化やジェスチャー検知をトリガーに状態遷移を制御。

### 3.4 描画・アニメーション
- **Unity案**: 影用スプライトやシェーダを用いて、Animatorで各ステートのアニメーションを制御。Easingを付けて椅子間を滑らかに移動。
- **TouchDesigner案**: TOP/CHOPで骨格データを受け取り、GLSLで影表現を生成。床面との一体感を出すために足元の接地影を描画。
- 状態に応じて表情・ポーズ・挙動を変化させ、観客の行動に反応する演出を制作。

### 3.5 インタラクション拡張
- 観客の手振り・立ち上がりなどのジェスチャーを検知し、影が返答。
- サウンドデザインを追加し、影の感情に合わせた効果音や環境音を再生。
- 観客が複数いる場合の会話風リアクション、協調動作などを検討。

## 4. 実装ステップ
1. **PoC構築**: 単一椅子で座位判定と影移動を確認。
2. **多座席対応**: 椅子IDと座標マップを整備し、状態管理を拡張。
3. **アニメーション制作**: 影キャラクター素材・モーションを作成。
4. **現地調整**: カメラ位置・照明・投影合わせを最適化し、長時間稼働テストを実施。
5. **ログ・運用**: 来場者数や反応ログを取得し、リセット操作や監視手順を準備。

## 5. 運用上のポイント
- 観客導線を考慮してカメラ視野が遮られないようにする。
- 子供や異なる体格の観客でも判定できるよう閾値を調整。
- 環境光の変化に備え、背景差分や露出設定をチューニング。

## 6. 想定タイムライン
- **Week 1-2**: センサー処理と座位判定の検証。
- **Week 3-4**: ステートマシン実装とアニメーションの基礎作成。
- **Week 5**: インタラクション強化・音響追加。
- **Week 6**: 現地リハーサル、最終調整、マニュアル整備。

## 7. テスト計画
- 長時間連続稼働テストでハード・ソフトの安定性を確認。
- 観客パターン別（1人／複数／子供など）での挙動確認。
- 例外時のフェイルセーフ（影が席を見失った場合のリセット）を実装。

